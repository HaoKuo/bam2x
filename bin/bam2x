#!/usr/bin/env python
# Programmer : zhuxp
# Date: 
# Last-modified: 02-12-2014, 15:25:46 EST
VERSION="0.1"
import os,sys,argparse
import signal
signal.signal(signal.SIGPIPE,signal.SIG_DFL)
from bam2x.Run import commands
def ParseArg():
    ''' This Function Parse the Argument '''
    p=argparse.ArgumentParser( description = 'bam2x', epilog='')
    p.add_argument('-v','--version',action='version',version='%(prog)s '+VERSION)
    
    
    group=argparse.ArgumentParser(add_help=False)
    group.add_argument('-i','--input',dest='input',default='stdin',type=str,help="input file Default: %(default)s")
    group.add_argument('-o','--output',dest='output',default='stdout',type=str,help="output file Default: %(default)s")
    
    mcpu_group=argparse.ArgumentParser(add_help=False)
    mcpu_group.add_argument('-n','--num_cpus',dest="num_cpus",type=str,default=4,help="number of cpus DEFAULT: %(default)i")
    
    subs=p.add_subparsers(help="subcommand help",dest="sub")
    for i in commands.keys():
        pi=subs.add_parser(i,help=commands[i].help(),parents=[mcpu_group,group])
        commands[i].set_parser(pi)
    if len(sys.argv)==1:
        print >>sys.stderr,p.print_help()
        exit(0)
    if len(sys.argv)==2:
        print >>sys.stderr,p.parse_args([sys.argv[1],'--help'])
        exit(0)
    return p

def Main():
    global args,out
    p=ParseArg()
    args=p.parse_args()
    commands[args.sub].run(args)


    
if __name__=="__main__":
    Main()








